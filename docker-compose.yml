# VetOS Production Docker Compose
# For use with Coolify - includes coolify network for Traefik routing

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        NEXT_PUBLIC_SUPABASE_URL: '${NEXT_PUBLIC_SUPABASE_URL}'
        NEXT_PUBLIC_SUPABASE_ANON_KEY: '${NEXT_PUBLIC_SUPABASE_ANON_KEY}'
    environment:
      NODE_ENV: production
      DATABASE_URL: '${DATABASE_URL}'
      AUTH_SECRET: '${AUTH_SECRET}'
      AUTH_TRUST_HOST: 'true'
      NEXTAUTH_URL: '${NEXTAUTH_URL}'
      NEXT_PUBLIC_SUPABASE_URL: '${NEXT_PUBLIC_SUPABASE_URL}'
      NEXT_PUBLIC_SUPABASE_ANON_KEY: '${NEXT_PUBLIC_SUPABASE_ANON_KEY}'
      SUPABASE_SERVICE_ROLE_KEY: '${SUPABASE_SERVICE_ROLE_KEY}'
      OPENAI_API_KEY: '${OPENAI_API_KEY}'
    healthcheck:
      test:
        - CMD
        - wget
        - '--no-verbose'
        - '--tries=1'
        - '--spider'
        - 'http://127.0.0.1:3000/api/auth/session'
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    restart: unless-stopped
    # NOTE: Do NOT add traefik labels here - Coolify manages routing automatically
    # Adding custom labels causes conflicts with Coolify-generated labels
    env_file:
      - .env

# Networks are managed by Coolify - do not define here
